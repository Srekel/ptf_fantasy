<!DOCTYPE html>
<html>
<head>
    <title>Pocket Task Force Fantasy</title>
    <meta charset="UTF-8">
    <style>
        body {
            background-color: white;
        }
        td.writeable_attribute {
            height:3em;
            width: 10ch;
            border: 1px solid black;
        }
        td.part_name {
            font-weight: bold;
            padding-right: 1em;
        }
        td.part_value {
            height:1em;
            width: 1em;
            border: 2px solid black;
        }
        td.part_value_selected {
            height:1em;
            width: 1em;
            background: lime;
            border: 2px solid black;
            text-align: center;
            font-weight: bold;
        }
        td.part_description {
            padding-left: 0.5em;
        }
        td.attribute {
            text-align: center;
        }
        td.part_race_attribute {
            text-align: center;
            height:1em;
            width: 4em;
        }

        table.characterpart tr.part:hover {
            background-color: orange;
        }
        #attributeheader {
            /*text-align: center;*/
            font-weight: bold;
            /*vertical-align: middle;*/
        }

        #test {
            margin-top: 25px;
            font-size: 21px;
            text-align: center;
            animation: fadein 1s;
            color: white;
        }

        @keyframes fadein {
            from { background-color: green; color:black; }
            to { background-color: white; color:white;}
        }
        form * {
            display: block;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div id="test">
        Page loaded
    </div>
    <div id="header">
        <div class="name">
            <span>
                Player name
           </span>
        </div>
        <div class="name">
            <span>
                Character name
           </span>
        </div>
        <div class="logo">
            <span>
                Pocket Task Force Fantasy Edition
           </span>
        </div>
    </div>

    <form onsubmit="download(this['name'].value, this['text'].value)">
    <input type="text" name="name" value="test.txt">
    <textarea name="text"></textarea>
    <input type="submit" value="Download">
    </form>

    <table>
        <tr>
            <td class="attribute">
                Level
            </td>
            <td class="attribute">
                Strength
            </td>
            <td class="attribute">
                Agility
            </td>
            <td class="attribute">
                Wisdom
            </td>
            <td class="attribute">
                Charisma
            </td>
            <td class="attribute">
                Money
            </td>
            <td class="attribute">
                Fate Points
            </td>
        </tr>
        <tr>
            <!-- level -->
            <td class="writeable_attribute">
            </td>
            <!-- SAWC -->
            <td class="writeable_attribute">
            </td>
            <td class="writeable_attribute">
            </td>
            <td class="writeable_attribute">
            </td>
            <td class="writeable_attribute">
            </td>
            <!-- money -->
            <td class="writeable_attribute">
            </td>
            <!-- fate points -->
            <td class="writeable_attribute">
            </td>
        </tr>
    </table>

    <h1>Races</h1>
    <div>
        <table class="characterpart" id="races">
            <thead>
                <tr>
                    <td>Race</td>
                    <td></td>
                    <td class="part_race_attribute">Strength</td>
                    <td class="part_race_attribute">Agility</td>
                    <td class="part_race_attribute">Wisdom</td>
                    <td class="part_race_attribute">Charisma</td>
                    <td class="part_race_attribute">Health</td>
                    <td>Bonus</td>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <h1>Perks</h1>
    <div>
        <table class="characterpart" id="perks">
            <thead>
                <tr>
                    <td class="perk_name">Perk</td>
                    <td class="perk_value"></td>
                    <td class="perk_description">Description</td>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <h1>Weapons</h1>
    <div>
        <table class="characterpart" id="weapons">
            <thead>
                <tr>
                    <td class="perk_name">Perk</td>
                    <td class="perk_value"></td>
                    <td class="perk_description">Action</td>
                    <td class="perk_description">Description</td>
                    <td class="perk_description">Rule</td>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        "use strict";

        var races = [
            ["Human", 3, 3, 3, 3, 15, "+3 Attribute Points"],
            ["Dwarf", 5, 2, 4, 2, 20, "+1 start perk"],
            ["Elf", 2, 4, 4, 4, 10, "-1D6 for enemies"],
            ["Halfling", 2, 4, 3, 4, 10, "+1D6 for non-combat Agility rolls"],
            ["Orc", 4, 4, 2, 2, 20, "+1D6 when flanked"],
        ];

        var perks = [
            ["Berzerker", "+1DPS for both character and enemies.", ["combat"]],
            ["Fast on Feet", "+1 Agility.", ["combat", "thief"]],
        ];

        var weapons = [
            ["Sword & Shield", [
                ["Attack", "AD6 * Strength damage"],
                ["Block", "AD6 * Strength damage", "Once"],
            ]],
            ["Two-handed Axe", [
                ["Attack", "AD6 * Strength damage"],
            ]],
        ];

        function clear_table(table) {
            // http://stackoverflow.com/questions/7271490/delete-all-rows-in-an-html-table
            // var tableRows = table.getElementsByTagName('tr');
            // var rowCount = tableRows.length;

            // for (var x=rowCount-1; x>0; x--) {
            //     elmtTable.removeChild(tableRows[x]);
            // }
            var new_tbody = document.createElement('tbody');
            //populate_with_new_rows(new_tbody);
            table.replaceChild(new_tbody, table.tBodies[0])
        }

        function setup_tables(character) {
            setup_race_table("races", races, character);
            setup_perk_table("perks", perks, character);
            setup_weapon_table("weapons", weapons, character);
        }

        function setup_race_table(table_name, races, character) {
            var race_table = document.getElementById(table_name);
            clear_table(race_table);

            races.forEach(function(race) {
                var row = race_table.tBodies[0].insertRow(-1);
                row.className = "part";
                row.onclick = function(){
                    var cell = this.getElementsByTagName("td")[0];
                    var id = cell.innerHTML;
                    character.race = id;
                    setup_tables(character);
                };

                var namecell = row.insertCell(-1);
                namecell.className = "part_name";
                namecell.innerHTML = race[0];

                var valuecell = row.insertCell(-1);
                valuecell.className = "part_value";
                if (race[0] == character.race) {
                    valuecell.className = "part_value_selected";
                    valuecell.innerHTML = "X";
                }

                var str_cell = row.insertCell(-1);
                str_cell.className = "part_race_attribute";
                str_cell.innerHTML = race[1];

                var agi_cell = row.insertCell(-1);
                agi_cell.className = "part_race_attribute";
                agi_cell.innerHTML = race[2];

                var wis_cell = row.insertCell(-1);
                wis_cell.className = "part_race_attribute";
                wis_cell.innerHTML = race[3];

                var cha_cell = row.insertCell(-1);
                cha_cell.className = "part_race_attribute";
                cha_cell.innerHTML = race[4];

                var hp_cell = row.insertCell(-1);
                hp_cell.className = "part_race_attribute";
                hp_cell.innerHTML = race[5];

                var bonus_cell = row.insertCell(-1);
                bonus_cell.className = "part_description";
                bonus_cell.innerHTML = race[6];
            });
        }

        function setup_perk_table(table_name, perks, character) {
            var perks_table = document.getElementById(table_name);
            clear_table(perks_table);

            perks.forEach(function(perk) {
                var row = perks_table.tBodies[0].insertRow(-1);
                row.className = "part";

                var namecell = row.insertCell(-1);
                namecell.className = "part_name";
                namecell.innerHTML = perk[0];

                var valuecell = row.insertCell(-1);
                valuecell.className = "part_value";

                var perks = character.perks;
                if (perks[perk[0]]) {
                    valuecell.className = "part_value_selected";
                    valuecell.innerHTML = perks[perk[0]];
                }

                var descriptioncell = row.insertCell(-1);
                descriptioncell.className = "part_description";
                descriptioncell.innerHTML = perk[1];
            });
        }

        function setup_weapon_table(table_name, weapons, character) {
            var weapons_table = document.getElementById(table_name);
            clear_table(weapons_table);

            weapons.forEach(function(weapon) {
                var row = weapons_table.tBodies[0].insertRow(-1);
                row.className = "part";

                var actions = weapon[1];
                var namecell = row.insertCell(0);
                namecell.className = "part_name";
                namecell.innerHTML = weapon[0];
                namecell.rowSpan = actions.length;

                var valuecell = row.insertCell(-1);
                valuecell.className = "part_value";
                valuecell.rowSpan = actions.length;

                var weapons = character.weapons;
                if (weapons[weapon[0]]) {
                    valuecell.className = "part_value_selected";
                    valuecell.innerHTML = weapons[weapon[0]];
                }

                var actioncell = row.insertCell(-1);
                actioncell.className = "part_description";
                actioncell.innerHTML = actions[0][0];
                var checkcell = row.insertCell(-1);
                checkcell.className = "part_description";
                checkcell.innerHTML = actions[0][1];
                var rulecell = row.insertCell(-1);
                rulecell.className = "part_description";
                rulecell.innerHTML = actions[0][2];

                for (var index = 1; index < actions.length; index++) {
                    var action = actions[index];
                    var action_row = weapons_table.insertRow(-1);
                    action_row.className = "part";

                    var actioncell = action_row.insertCell(-1);
                    actioncell.className = "part_description";
                    actioncell.innerHTML = action[0];
                    var checkcell = action_row.insertCell(-1);
                    checkcell.className = "part_description";
                    checkcell.innerHTML = action[1];
                    var rulecell = action_row.insertCell(-1);
                    rulecell.className = "part_description";
                    rulecell.innerHTML = action[2];
                }

                // actions.forEach(function(action) {
                //     var valuecell = row.insertCell(-1);
                //     valuecell.className = "part_value";

                //     var descriptioncell = row.insertCell(-1);
                //     descriptioncell.className = "part_description";
                //     descriptioncell.innerHTML = weapon[1];
                // });
            });
        }

        var character = {
            char_name: "LOL",
            player_name: "PlayerLOL",
            race: "Dwarf",
            perks: {
                Berzerker: 1,
            },
            weapons: {
                "Sword & Shield": 1,
            }
        }

        setup_tables(character);

        // var perktable = document.getElementById("combatperks");
        // perks.forEach(function(item, index, array) {
        //     var row = perktable.insertRow(0);
        //     var namecell = row.insertCell(0);
        //     namecell.className = "perk_name";
        //     namecell.innerHTML = item;

        //     var valuecell = row.insertCell(1);
        //     valuecell.className = "perk_value";

        //     var descriptioncell = row.insertCell(2);
        //     descriptioncell.className = "perk_description";
        //     descriptioncell.innerHTML = "LOL";
        // });
    </script>

    <script type="text/javascript">
        function download(filename, text) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }

    //function loadFile() {
    //    var input, file, fr;
//
    //    if (typeof window.FileReader !== 'function') {
    //        alert("The file API isn't supported on this browser yet.");
    //        return;
    //    }
//
    //    input = document.getElementById('fileinput');
    //    if (!input) {
    //        alert("Um, couldn't find the fileinput element.");
    //    }
    //    else if (!input.files) {
    //        alert("This browser doesn't seem to support the `files` property of file inputs.");
    //    }
    //    else if (!input.files[0]) {
    //        alert("Please select a file before clicking 'Load'");
    //    }
    //    else {
    //        file = input.files[0];
    //        fr = new FileReader();
    //        fr.onload = receivedText;
    //        fr.readAsText(file);
    //    }
//
    //    function receivedText(e) {
    //        lines = e.target.result;
    //        var newArr = JSON.parse(lines);
    //    }
    //}
    </script>
</body>
</html>